\hypertarget{scenario_8_f90}{}\section{scenario.\+F90 File Reference}
\label{scenario_8_f90}\index{scenario.\+F90@{scenario.\+F90}}


The \mbox{\hyperlink{namespacepmc__scenario}{pmc\+\_\+scenario}} module.  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \mbox{\hyperlink{structpmc__scenario_1_1scenario__t}{pmc\+\_\+scenario\+::scenario\+\_\+t}}
\begin{DoxyCompactList}\small\item\em Scenario data. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Modules}
\begin{DoxyCompactItemize}
\item 
module \mbox{\hyperlink{namespacepmc__scenario}{pmc\+\_\+scenario}}
\begin{DoxyCompactList}\small\item\em The \mbox{\hyperlink{structpmc__scenario_1_1scenario__t}{scenario\+\_\+t}} structure and associated subroutines. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a9ba2febb35bfe14fe1ce49994de7fdb9}{pmc\+\_\+scenario\+::scenario\+\_\+init\+\_\+env\+\_\+state}} (scenario, env\+\_\+state, time)
\begin{DoxyCompactList}\small\item\em Initialize the time-\/dependent contents of the environment. Thereafter \mbox{\hyperlink{namespacepmc__scenario_a88ccdf6c90762496ecbb93e45cc92bb7}{scenario\+\_\+update\+\_\+env\+\_\+state()}} should be used. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a88ccdf6c90762496ecbb93e45cc92bb7}{pmc\+\_\+scenario\+::scenario\+\_\+update\+\_\+env\+\_\+state}} (scenario, env\+\_\+state, time)
\begin{DoxyCompactList}\small\item\em Update time-\/dependent contents of the environment. \mbox{\hyperlink{namespacepmc__scenario_a9ba2febb35bfe14fe1ce49994de7fdb9}{scenario\+\_\+init\+\_\+env\+\_\+state()}} should have been called at the start. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a8da20291ae6441134e5f1788a906e96b}{pmc\+\_\+scenario\+::scenario\+\_\+update\+\_\+gas\+\_\+state}} (scenario, delta\+\_\+t, env\+\_\+state, old\+\_\+env\+\_\+state, gas\+\_\+data, gas\+\_\+state)
\begin{DoxyCompactList}\small\item\em Do gas emissions and background dilution. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a6d0621141b705a051b14761430d385ca}{pmc\+\_\+scenario\+::scenario\+\_\+update\+\_\+aero\+\_\+state}} (scenario, delta\+\_\+t, env\+\_\+state, old\+\_\+env\+\_\+state, aero\+\_\+data, aero\+\_\+state, n\+\_\+emit, n\+\_\+dil\+\_\+in, n\+\_\+dil\+\_\+out, allow\+\_\+doubling, allow\+\_\+halving)
\begin{DoxyCompactList}\small\item\em Do emissions and background dilution for a particle aerosol distribution. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_aa8ca6c77c94665bdbf4c4f25e2dd1523}{pmc\+\_\+scenario\+::scenario\+\_\+update\+\_\+aero\+\_\+binned}} (scenario, delta\+\_\+t, env\+\_\+state, old\+\_\+env\+\_\+state, bin\+\_\+grid, aero\+\_\+data, aero\+\_\+binned)
\begin{DoxyCompactList}\small\item\em Do emissions and background dilution from the environment for a binned aerosol distribution. \end{DoxyCompactList}\item 
real(kind=dp) function \mbox{\hyperlink{namespacepmc__scenario_ab60e2eeb66ae8849ad11923d76a9bd7f}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+rate}} (scenario, vol, density, aero\+\_\+data, env\+\_\+state)
\begin{DoxyCompactList}\small\item\em Evaluate a loss rate function. \end{DoxyCompactList}\item 
real(kind=dp) function \mbox{\hyperlink{namespacepmc__scenario_adbc0c60c8638d7bc02416577dedf89ac}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+rate\+\_\+dry\+\_\+dep}} (vol, density, aero\+\_\+data, env\+\_\+state)
\begin{DoxyCompactList}\small\item\em Compute and return the dry deposition rate for a given particle. All equations used here are written in detail in the file {\ttfamily doc/deposition/deposition.\+tex}. \end{DoxyCompactList}\item 
real(kind=dp) function \mbox{\hyperlink{namespacepmc__scenario_a3b3b510051adbe1f82741b50ea7d5857}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+rate\+\_\+max}} (scenario, vol, aero\+\_\+data, env\+\_\+state)
\begin{DoxyCompactList}\small\item\em Compute and return the max loss rate function for a given volume. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a5b6292cb3c74aba853700581ea964bc0}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+rate\+\_\+bin\+\_\+max}} (scenario, bin\+\_\+grid, aero\+\_\+data, env\+\_\+state, loss\+\_\+max)
\begin{DoxyCompactList}\small\item\em Compute an upper bound on the maximum kernel value for each bin. Value over\+\_\+scale is multiplied to the maximum sampled value to get the upper bound. A tighter bound may be reached if over\+\_\+scale is smaller, but that also risks falling below a kernel value. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a275a4562c174d7090db3120235d4e97f}{pmc\+\_\+scenario\+::scenario\+\_\+particle\+\_\+loss}} (scenario, delta\+\_\+t, aero\+\_\+data, aero\+\_\+state, env\+\_\+state)
\begin{DoxyCompactList}\small\item\em Performs stochastic particle loss for one time-\/step. If a particle {\ttfamily i\+\_\+part} has a \mbox{\hyperlink{namespacepmc__scenario_ab60e2eeb66ae8849ad11923d76a9bd7f}{scenario\+\_\+loss\+\_\+rate()}} value of rate, then the probability p will be removed by this function is {\ttfamily 1 -\/ exp(-\/delta\+\_\+t$\ast$rate)}. Uses an accept-\/reject algorithm for efficiency, in which a particle is first sampled with rate {\ttfamily 1 -\/ exp(-\/delta\+\_\+t$\ast$over\+\_\+rate) } and then accepted with rate {\ttfamily (1 -\/ exp(-\/delta\+\_\+t$\ast$rate))/(1 -\/ exp(-\/delta\+\_\+t$\ast$over\+\_\+rate))}. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_ab3b05e77d36cc1b27c10ebd8d315df61}{pmc\+\_\+scenario\+::scenario\+\_\+try\+\_\+single\+\_\+particle\+\_\+loss}} (scenario, delta\+\_\+t, aero\+\_\+data, aero\+\_\+state, env\+\_\+state, i\+\_\+part, over\+\_\+prob)
\begin{DoxyCompactList}\small\item\em Test a candidate particle to see if it should be removed, and remove if necessary. Particle is removed with probability (1d0 -\/ exp(-\/delta\+\_\+t$\ast$rate))/over\+\_\+prob, where rate is the loss function evaluated for the given particle. \end{DoxyCompactList}\item 
elemental logical function \mbox{\hyperlink{namespacepmc__scenario_afaea66be4e0e1ec9a4b80a2fda61f972}{pmc\+\_\+scenario\+::scenario\+\_\+contains\+\_\+aero\+\_\+mode\+\_\+type}} (scenario, aero\+\_\+mode\+\_\+type)
\begin{DoxyCompactList}\small\item\em Whether any of the contained aerosol modes are of the given type. \end{DoxyCompactList}\item 
integer function \mbox{\hyperlink{namespacepmc__scenario_a135753482d6e0a63cf3947e6e017c618}{pmc\+\_\+scenario\+::pmc\+\_\+mpi\+\_\+pack\+\_\+size\+\_\+scenario}} (val)
\begin{DoxyCompactList}\small\item\em Determines the number of bytes required to pack the given value. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_a93772962c3e78b32063cb735d357878a}{pmc\+\_\+scenario\+::pmc\+\_\+mpi\+\_\+pack\+\_\+scenario}} (buffer, position, val)
\begin{DoxyCompactList}\small\item\em Packs the given value into the buffer, advancing position. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacepmc__scenario_afddd83d6cfc65b32e3cce01d70ecdf85}{pmc\+\_\+scenario\+::pmc\+\_\+mpi\+\_\+unpack\+\_\+scenario}} (buffer, position, val)
\begin{DoxyCompactList}\small\item\em Unpacks the given value from the buffer, advancing position. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_a2b2e63100da1707d0529fc22239daa8e}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+invalid}} = 0
\begin{DoxyCompactList}\small\item\em Type code for an undefined or invalid loss function. \end{DoxyCompactList}\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_a698827c1bd003fdbf988b3813305322e}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+none}} = 1
\begin{DoxyCompactList}\small\item\em Type code for a zero loss function. \end{DoxyCompactList}\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_a860cf47bb81e54f7ef8bc666bf7c76f0}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+constant}} = 2
\begin{DoxyCompactList}\small\item\em Type code for a constant loss function. \end{DoxyCompactList}\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_ad3122dfa9b3c59624cdef63b4ebd807d}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+volume}} = 3
\begin{DoxyCompactList}\small\item\em Type code for a loss rate function proportional to particle volume. \end{DoxyCompactList}\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_a44b0747589f4aac5fb700b51d0861cd0}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+drydep}} = 4
\begin{DoxyCompactList}\small\item\em Type code for a loss rate function based on dry deposition. \end{DoxyCompactList}\item 
integer, parameter \mbox{\hyperlink{namespacepmc__scenario_a0e9c46d308800f28d977960a1d5918ae}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+function\+\_\+chamber}} = 5
\begin{DoxyCompactList}\small\item\em Type code for a loss rate function for chamber experiments. \end{DoxyCompactList}\item 
real(kind=dp), parameter \mbox{\hyperlink{namespacepmc__scenario_a9a75d68d9d307fb489fed7ff06735c39}{pmc\+\_\+scenario\+::scenario\+\_\+loss\+\_\+alg\+\_\+threshold}} = 1.\+0d0
\begin{DoxyCompactList}\small\item\em Parameter to switch between algorithms for particle loss. A value of 0 will always use the naive algorithm, and a value of 1 will always use the accept-\/reject algorithm. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The \mbox{\hyperlink{namespacepmc__scenario}{pmc\+\_\+scenario}} module. 

